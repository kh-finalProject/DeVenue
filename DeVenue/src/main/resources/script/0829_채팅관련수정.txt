--기존 테이블 삭제
DROP TABLE "CHAT";
DROP TABLE "MESSAGE";
DROP TABLE "CHATROOM";

--다시 테이블 만들기
CREATE TABLE "CHAT" (
	"CHAT_ID"	NUMBER		NOT NULL,
	"FROM_ID"	NUMBER		NOT NULL,
	"TO_ID"	NUMBER		NOT NULL,
	"ROOM_ID"	NUMBER		NOT NULL,
	"CHAT_STATUS"	VARCHAR2(3)	DEFAULT 'Y'	NULL
);

COMMENT ON COLUMN "CHAT"."CHAT_ID" IS '채팅 기본키';

COMMENT ON COLUMN "CHAT"."FROM_ID" IS '발신자, 회원테이블의 기본키';

COMMENT ON COLUMN "CHAT"."TO_ID" IS '수신자, 회원테이블의 기본키';

COMMENT ON COLUMN "CHAT"."ROOM_ID" IS '채팅방 테이블 기본키';

COMMENT ON COLUMN "CHAT"."CHAT_STATUS" IS '대화상대가 없어지거나 채팅방이 존재하지 않으면 N';


CREATE TABLE "MESSAGE" (
	"MESSAGE_ID"	NUMBER		NOT NULL,
	"ROOM_ID"	NUMBER		NOT NULL,
	"FROM_ID"	NUMBER		NULL,
	"CHAT_CONTENT"	VARCHAR2(4000)		NULL,
	"ORIGIN_FILENAME"	VARCHAR2(4000)		NULL,
	"RENAME_FILENAME"	VARCHAR(255)		NULL,
	"READ"	VARCHAR2(3)	DEFAULT 'N'	NULL,
	"MSG_CREATE_DATE"	TIMESTAMP DEFAULT SYSDATE	NULL
);

COMMENT ON COLUMN "MESSAGE"."MESSAGE_ID" IS '메시지 기본키';

COMMENT ON COLUMN "MESSAGE"."ROOM_ID" IS '채팅방 기본키';

COMMENT ON COLUMN "MESSAGE"."FROM_ID" IS '보낸사람 회원번호';

COMMENT ON COLUMN "MESSAGE"."CHAT_CONTENT" IS '채팅 내용';

COMMENT ON COLUMN "MESSAGE"."ORIGIN_FILENAME" IS '채팅에서 보낸 파일의 원본이름';

COMMENT ON COLUMN "MESSAGE"."RENAME_FILENAME" IS '채팅에서 보낸 파일의 재생성된 이름';

COMMENT ON COLUMN "MESSAGE"."READ" IS '읽은 메시지인지 여부 CHECK제약조건 Y/N';

COMMENT ON COLUMN "MESSAGE"."MSG_CREAET_DATE" IS '보낸 시간';



CREATE TABLE "CHATROOM" (
	"ROOM_ID"	NUMBER		NOT NULL,
	"ROOM_NAME"	VARCHAR2(4000)		NULL,
	"ROOM_STATUS"	VARCHAR2(3)	DEFAULT 'Y'	NULL
);

COMMENT ON COLUMN "CHATROOM"."ROOM_ID" IS '채팅방 기본키';

COMMENT ON COLUMN "CHATROOM"."ROOM_NAME" IS '채팅방 이름';

COMMENT ON COLUMN "CHATROOM"."ROOM_STATUS" IS '채팅방 나가기 여부';

--기본키
ALTER TABLE "CHAT" ADD CONSTRAINT "PK_CHAT" PRIMARY KEY (
	"CHAT_ID"
);

ALTER TABLE "MESSAGE" ADD CONSTRAINT "PK_MESSAGE" PRIMARY KEY (
	"MESSAGE_ID"
);
ALTER TABLE "CHATROOM" ADD CONSTRAINT "PK_CHATROOM" PRIMARY KEY (
	"ROOM_ID"
);

--외래키
ALTER TABLE "CHAT" ADD CONSTRAINT "FK_MEMBER_TO_CHAT_1" FOREIGN KEY (
	"FROM_ID"
)
REFERENCES "MEMBER" (
	"MEM_ID"
);

ALTER TABLE "CHAT" ADD CONSTRAINT "FK_MEMBER_TO_CHAT_2" FOREIGN KEY (
	"TO_ID"
)
REFERENCES "MEMBER" (
	"MEM_ID"
);

ALTER TABLE "CHAT" ADD CONSTRAINT "FK_CHATROOM_TO_CHAT_1" FOREIGN KEY (
	"ROOM_ID"
)
REFERENCES "CHATROOM" (
	"ROOM_ID"
);

ALTER TABLE "MESSAGE" ADD CONSTRAINT "FK_CHATROOM_TO_MESSAGE_1" FOREIGN KEY (
	"ROOM_ID"
)
REFERENCES "CHATROOM" (
	"ROOM_ID"
);

-- 회원 채팅 설정 테이블 생성
CREATE TABLE "MEM_CHATSET" (
	"MEM_ID"	NUMBER		NOT NULL,
	"IS_TRANS_CHAT"	VARCHAR2(3)	DEFAULT 'Y'	NULL,
	"IS_SHOWPASTCHAT"	VARCHAR2(3)	DEFAULT 'N'	NULL
);

COMMENT ON COLUMN "MEM_CHATSET"."MEM_ID" IS '회원 기본키';

COMMENT ON COLUMN "MEM_CHATSET"."IS_TRANS_CHAT" IS '번역 표시 여부';

COMMENT ON COLUMN "MEM_CHATSET"."IS_SHOWPASTCHAT" IS '종료된 메시지 표시여부';

ALTER TABLE "MEM_CHATSET" ADD CONSTRAINT "FK_MEMBER_TO_MEM_CHATSET_1" FOREIGN KEY (
	"MEM_ID"
)
REFERENCES "MEMBER" (
	"MEM_ID"
);
